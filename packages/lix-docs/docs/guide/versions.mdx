import CodeSnippet from "../components/code-snippet";
import * as gettingStartedExample from "./versions.getting-started.ts";
import gettingStartedSrcCode from "./versions.getting-started.ts?raw";
import * as autoCommitExample from "./versions.auto-commit.ts";
import autoCommitSrcCode from "./versions.auto-commit.ts?raw";

# Versions - The safety net for AI agents 

Give every AI agent (& human) its own playground, keep the main version safe.

Agents act fast and often unpredictably; uncontrolled writes can trash live data. Versions create “sealed rooms” where agents iterate without collateral damage.

![Versions](/versions.svg)

> [!TIP]
> Lix uses the term "version" instead of "branch" because it's more intuitive for non-technical users. "Version" mirrors the familiar concept of duplicating a file and adding `v2` or `final` to the file name e.g. `something_v2.docx` or `something_final.docx`.

The super-power is that **Lix auto-commits every transaction**. Unlike Git which requires manual `git commit` operations, Lix creates a new commit in the history for every modification. Versions provide a stable, human-friendly way to manage this rapid, continuous history.

## Why versions matter for agent-powered apps

| Benefit | What it unlocks in production |
|---------|------------------------------|
| **Parallel work** | Multiple AI agents—and human editors—can make different changes at the same time without overwriting each other's progress. |
| **Risk - free experiments** | Let agents make changes without impacting the users' version—delete instantly if results disappoint. |
| **Clear diffs & reviews** | See exactly *what* each agent (or human) changes between versions. |

## Use cases

### Human-AI Agent Collaboration

1. Agent (or your orchestration layer) **creates a version**.
2. Agent writes data; Lix **auto-commits** each change.
3. Human (or another agent) **asks for a diff vs main**.
4. On approval, **merge or discard** the version.

```typescript
// 1. Create and switch to an isolated version for Agent A
const versionA = await createVersion({ lix, name: "agent-a-playground" });
await switchVersion({ lix, to: versionA });

// 2. Agent writes changes (auto-committed under the hood)
await agentA.runTasks(lix);

// 3. Diff against main
const diff = await diffVersion({ lix, from: versionA.id, to: "main" });

// 4. Review / merge or drop
if (await humanApproves(diff)) {
  await mergeVersion({ lix, from: versionA.id, into: "main" });
} else {
  await deleteVersion({ lix, id: versionA.id });
}
```

### A/B Testing

Let different AI agents create competing advertisements autonomously, then automatically promote the one with better conversion rates.

```typescript
// Create parallel versions for competing agents
const versionA = await createVersion({ lix, name: "agent-a-campaign" });
const versionB = await createVersion({ lix, name: "agent-b-campaign" });

// Let agents work autonomously with their own strategies
agentA.createAdvertisements(versionA),
agentB.createAdvertisements(versionB)

// Compare performance and merge the winner
const winner = await determineWinner(versionA, versionB);

await mergeVersion({ lix, source: winner.id, target: "main" });

// Clean up the losing version
const loser = winner.id === versionA.id ? versionB : versionA;
await deleteVersion({ lix, id: loser.id });

// Winner function compares conversion rates
async function determineWinner(versionA, versionB) {
  const [conversionsA, conversionsB] = await Promise.all([
    getConversionRate(versionA),
    getConversionRate(versionB)
  ]);
  
  return conversionsA > conversionsB ? versionA : versionB;
}
```

**Key benefits:**
- **Safe experimentation**: Both agents work in isolation, no risk to production
- **Data-driven decisions**: Compare real performance metrics, not just agent confidence
- **Easy rollback**: If both experiments fail, main version stays untouched
- **Scalable testing**: Run dozens of agent experiments simultaneously



## How Versions Work

Versions in Lix are like branches in Git—they are named pointers that express different states of data, experiment in parallel, and maintain a clear history of changes.


Technically, a version is a named reference that points to two key commits in the history, providing both a stable anchor and a live view of current work:

- **Where you are** in the commit graph (`commit_id`)
- **What you're working on** via a special working commit (`working_commit_id`)
- **Where you came from** through inheritance (`inherits_from_version_id`)

```
Version A (main)      ──► commit (245) ↘
                                        commit (309) ──► commit (38e) ...
Version B (feature-x) ──► commit (sh4) ↗
```

## Interactive example

Versions let you work with different states of your data in isolation. Here's a simple example showing how to update product prices in a separate version:

<CodeSnippet
  module={gettingStartedExample}
  srcCode={gettingStartedSrcCode}
  sections={["getting-started-versions"]}
/>

## How versions work under the hood

Every change in Lix creates an auto-commit. A **checkpoint** is simply a commit with a "checkpoint" label—nothing more, nothing less.

The **working commit** is computed dynamically: it represents all commits since the last checkpoint.

```
commit_1 ← commit_2 ← commit_3 (checkpoint) ← commit_4 ← commit_5 ← commit_6
                           ↑                                         ↑
                       commit_id                              working_commit_id
                    (last checkpoint)                    (computed: commits 4-6)
```

### Auto-commits in action

<CodeSnippet
  module={autoCommitExample}
  srcCode={autoCommitSrcCode}
  sections={["auto-commits"]}
/>

## API reference quick-links

| Function / Type      | Purpose                     | Docs                                   |
| -------------------- | --------------------------- | -------------------------------------- |
| `createVersion()`    | Create a new version branch | [API](/api/functions/createVersion)    |
| `switchVersion()`    | Change active version       | [API](/api/functions/switchVersion)    |
| `createCheckpoint()` | Create a labeled commit     | [API](/api/functions/createCheckpoint) |
| `LixVersion`         | Version type definition     | [API](/api/types/LixVersion)           |
